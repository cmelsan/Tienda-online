---
export const prerender = false;
import { supabase } from '@/lib/supabase';

let message = '';
let data = null;
let error = null;

try {
  const result = await supabase.from('profiles').select('*');
  data = result.data;
  error = result.error;
} catch (e) {
  message = e.message;
}

const { data: { session } } = await supabase.auth.getSession();
---

<html lang="es">
<head>
    <title>Test DB</title>
</head>
<body class="p-8 bg-gray-100 font-mono text-sm">
    <h1 class="text-xl font-bold mb-4">Diagnóstico de Base de Datos</h1>
    
    <div class="mb-8 p-4 bg-white rounded shadow">
        <h2 class="font-bold mb-2">Sesión Actual</h2>
        <pre>{JSON.stringify(session, null, 2)}</pre>
    </div>

    <div class="mb-8 p-4 bg-white rounded shadow">
        <h2 class="font-bold mb-2">Consulta a 'profiles'</h2>
        {message && <div class="text-red-500 font-bold mb-2">Excepción: {message}</div>}
        {error && <div class="text-red-500 font-bold mb-2">Error Supabase: {JSON.stringify(error, null, 2)}</div>}
        
        <h3 class="font-bold mt-4">Datos (debería mostrar tu usuario admin):</h3>
        <pre class="bg-gray-50 p-2 border mt-2">{JSON.stringify(data, null, 2)}</pre>
    </div>
    
    <div class="p-4 bg-yellow-50 border border-yellow-200 text-yellow-800">
        Si "Datos" está vacío o da error, el problema es la tabla o los permisos (RLS).
    </div>
</body>
</html>
