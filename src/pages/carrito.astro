---
export const prerender = false; // SSR

import PublicLayout from '@/layouts/PublicLayout.astro';
import Button from '@/components/ui/Button.astro';
---

<PublicLayout
  title="Carrito de Compra - ÉCLAT"
  description="Revisa tu carrito de compra"
>
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <h1 class="text-display-md font-serif font-light text-noir-900 mb-8">
      Carrito de Compra
    </h1>

    <div id="cart-container" class="space-y-6">
      <!-- Cart items will be rendered by client-side script -->
    </div>

    <div class="mt-8 text-center">
      <p class="text-noir-600 mb-4">
        El carrito se gestiona completamente desde el cliente.
        Haz clic en el icono del carrito en la navegación para ver y gestionar tus productos.
      </p>
      <Button href="/productos" variant="primary" size="lg">
        Continuar Comprando
      </Button>
    </div>
  </div>
</PublicLayout>

<script>
  import { cartItemsArray, cartTotal } from '@/stores/cart';
  import { formatPrice } from '@/lib/utils';

  const container = document.getElementById('cart-container');
  
  cartItemsArray.subscribe((items) => {
    if (!container) return;

    if (items.length === 0) {
      container.innerHTML = `
        <div class="text-center py-12">
          <svg class="w-24 h-24 text-noir-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
          </svg>
          <p class="text-xl text-noir-700 mb-2">Tu carrito está vacío</p>
          <p class="text-noir-500">Añade productos para comenzar tu compra</p>
        </div>
      `;
    } else {
      const total = cartTotal.get();
      container.innerHTML = `
        <div class="bg-white rounded-lg shadow-soft p-6">
          <h2 class="text-xl font-serif text-noir-900 mb-4">Resumen del Pedido</h2>
          <div class="space-y-4">
            ${items.map((item) => `
              <div class="flex items-center space-x-4 pb-4 border-b border-noir-200">
                <img
                  src="${item.product.images[0] || '/placeholder-product.jpg'}"
                  alt="${item.product.name}"
                  class="w-20 h-20 object-cover rounded-lg bg-cream-100"
                />
                <div class="flex-1">
                  <h3 class="font-medium text-noir-900">${item.product.name}</h3>
                  <p class="text-sm text-noir-600">Cantidad: ${item.quantity}</p>
                  <p class="text-sm font-semibold text-noir-900">${formatPrice(item.product.price * item.quantity)}</p>
                </div>
              </div>
            `).join('')}
          </div>
          <div class="mt-6 pt-6 border-t border-noir-200">
            <div class="flex justify-between items-center text-xl font-semibold">
              <span class="text-noir-900">Total:</span>
              <span class="text-noir-900">${formatPrice(total)}</span>
            </div>
          </div>
        </div>
        <div class="mt-6 bg-cream-100 rounded-lg p-6 text-center">
          <p class="text-noir-700 mb-2">
            <strong>Nota:</strong> Esta es una tienda de demostración académica.
          </p>
          <p class="text-sm text-noir-600">
            El proceso de pago no está implementado en esta versión.
          </p>
        </div>
      `;
    }
  });
</script>
</PublicLayout>
