---
import PublicLayout from '@/layouts/PublicLayout.astro';
import ProductCard from '@/components/product/ProductCard.astro';
import { supabase } from '@/lib/supabase';

// Check Global Settings
const { data: offersSettings } = await supabase
  .from('app_settings')
  .select('value')
  .eq('key', 'offers_enabled')
  .single();

if (offersSettings?.value === false) {
    return Astro.redirect('/');
}

// Fetch products (in a real app, filtering by discount)
const { data: products } = await supabase
  .from('products')
  .select('*, brand:brands(name)')
  .order('price', { ascending: true }); // Cheap stuff first as "offers"

---

<PublicLayout title="Ofertas Beauty - ÉCLAT" description="Las mejores ofertas en maquillaje, perfumes y tratamiento.">
  <div class="bg-[#ffecf0] text-beauty-red py-12 text-center border-b border-pink-200">
      <h1 class="text-4xl md:text-6xl font-bold uppercase tracking-tight mb-4">Beauty Ofertas</h1>
      <p class="text-lg text-black font-medium">Tus favoritos al mejor precio. ¡Corre que vuelan!</p>
  </div>

  <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
       <div class="grid grid-cols-2 md:grid-cols-4 gap-x-4 gap-y-8 md:gap-x-8 md:gap-y-12">
            {products?.map(product => (
                 <ProductCard 
                    product={{
                        ...product, 
                        brand: product.brand?.name || 'Marca',
                        isPromo: true, // Force promo badge visually
                        originalPrice: Math.round(product.price * 1.3)
                    }} 
                />
            ))}
        </div>
  </section>
</PublicLayout>
