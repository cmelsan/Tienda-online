---
import PublicLayout from '@/layouts/PublicLayout.astro';
import { supabase } from '@/lib/supabase';

// Fetch all brands
const { data: brands } = await supabase
  .from('brands')
  .select('*')
  .order('name');

// Group brands by letter
const groupedBrands = brands?.reduce((acc, brand) => {
  const letter = brand.name.charAt(0).toUpperCase();
  // Handle brands starting with numbers or symbols if necessary, for now basic A-Z
  const key = /[A-Z]/.test(letter) ? letter : '#';
  
  if (!acc[key]) acc[key] = [];
  acc[key].push(brand);
  return acc;
}, {} as Record<string, typeof brands>);

const letters = Object.keys(groupedBrands || {}).sort();
---

<PublicLayout
  title="Nuestras Marcas - ÉCLAT"
  description="Explora las marcas de belleza más exclusivas en ÉCLAT. L'Oréal, Maybelline, Estée Lauder y más."
>
  <div class="bg-black text-white py-12 md:py-20 border-b border-gray-900">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h1 class="text-display-md font-bold uppercase tracking-tight mb-4">Marcas</h1>
      <p class="text-lg md:text-xl text-gray-400 font-light max-w-2xl mx-auto mb-10 text-pretty">
        Descubre nuestra selección de las casas de belleza más prestigiosas del mundo.
      </p>

      {/* Quick Navigation A-Z */}
      <div class="flex flex-wrap justify-center gap-2 md:gap-4 text-xs md:text-sm font-bold uppercase tracking-widest text-gray-500">
        {letters?.map((letter) => (
            <a href={`#brand-section-${letter}`} class="hover:text-white hover:scale-125 transition-all duration-300 w-6 h-6 flex items-center justify-center">
                {letter}
            </a>
        ))}
      </div>
    </div>
  </div>

  <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 md:py-20">
    {letters?.map((letter) => (
        <div id={`brand-section-${letter}`} class="mb-16 md:mb-24 scroll-mt-24">
            <h2 class="text-4xl md:text-6xl font-bold text-gray-100 uppercase mb-8 border-b border-gray-100 pb-4 flex items-baseline">
                {letter}
                <span class="text-xs text-gray-400 ml-4 tracking-widest font-medium">{groupedBrands[letter].length} MARCAS</span>
            </h2>
            
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-x-4 gap-y-6 md:gap-8">
                {groupedBrands[letter].map((brand) => (
                    <a href={`/marcas/${brand.slug}`} class="group block">
                       <div class="aspect-[3/2] flex items-center justify-center bg-gray-50 mb-3 group-hover:bg-gray-100 transition-colors px-4">
                           {brand.logo_url ? (
                                <img src={brand.logo_url} alt={brand.name} class="max-w-full max-h-12 object-contain opacity-70 group-hover:opacity-100 grayscale group-hover:grayscale-0 transition-all" />
                           ) : (
                                <span class="text-lg font-bold text-gray-300 group-hover:text-black transition-colors">
                                    {brand.name}
                                </span>
                           )}
                       </div>
                    </a>
                ))}
            </div>
        </div>
    ))}

    {(!letters || letters.length === 0) && (
      <div class="text-center py-20">
        <p class="text-gray-500">No hay marcas disponibles en este momento.</p>
      </div>
    )}
  </section>
</PublicLayout>
