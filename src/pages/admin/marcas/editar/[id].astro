---
export const prerender = false;
import AdminLayout from '@/layouts/AdminLayout.astro';
import BrandForm from '@/components/admin/BrandForm';
import { createServerSupabaseClient } from '@/lib/supabase';

const { id } = Astro.params;

if (!id) {
  return Astro.redirect('/admin/marcas');
}

const supabase = await createServerSupabaseClient(Astro);

// Get session
const { data: { session } } = await supabase.auth.getSession();

const { data: brand, error: fetchError } = await supabase
  .from('brands')
  .select('*')
  .eq('id', id)
  .single();

if (fetchError || !brand) {
  return Astro.redirect('/admin/marcas');
}
---

<AdminLayout title={`Editar Marca: ${brand.name}`}>
  <BrandForm client:load token={session?.access_token || ''} brand={brand} isEdit={true} />
</AdminLayout>
